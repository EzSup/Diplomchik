@page "/cart/{userId:guid}"
@using Restaurant.Client.Contracts.Carts
@using Restaurant.Client.Contracts.Customers
@using Restaurant.Client.Contracts.Enums
@inject ICartsService cartService
@inject ICustomersService customersService
<div>
@if (cart != null && cart.Dishes.Count > 0)
{
    @foreach (var dish in cart.Dishes)
    {
        <DishRowOfCart Dish="dish" OnButtonClick="() => Update(dish.Id, dish.count)"></DishRowOfCart>
    }

    <div class="form-group">
        <lable class="form-Label">Тип замовлення</lable>
        <div @bind="orderType">
            <p value="@OrderType.InRestaurant">В ресторані</p>
            <p value="@OrderType.Delivery">Доставка</p>
        </div>
    </div>
    <button @onclick="Continue">
        Підтвердити і продовжити
    </button>
}
else
{
    <h1>Корзина пуста, <a href="/menu">оберіть собі щось смачненьке!</a></h1>
}
</div>
@code {

    [Parameter]
    public Guid userId { get; set; }
    private OrderType orderType = OrderType.InRestaurant;

    private Guid customerId;

    CartResponse cart;

    protected override async Task OnInitializedAsync()
    {
        customerId = (await customersService.GetByUserId(userId)).Id;
        localStorage.AddItem("customerId", customerId.ToString());
        cart = await cartService.GetByCustomer(customerId);
    }
    private async Task Update(Guid dishId, int count)
    {
        cart = await cartService.AddDishToCartOfCustomerByCustomerId(customerId, dishId, count);
        
    }

    private void Continue()
    {
        switch (orderType)
        {
            case OrderType.InRestaurant:
                NavManager.NavigateTo("/selectTable");
                break;
            case OrderType.Delivery:                
                NavManager.NavigateTo("/deliveryForm");
                break;
        }
    }    
}
